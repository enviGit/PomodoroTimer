<Window x:Class="PomodoroTimer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:PomodoroTimer.ViewModels"
        xmlns:conv="clr-namespace:PomodoroTimer.Converters"  Title="Pomodoro Timer" Height="600" Width="400"
        WindowStartupLocation="CenterScreen" ResizeMode="CanMinimize"
        Background="#1E1E2E" Icon="/appIcon.png">

    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <conv:BoolToStringConverter x:Key="BoolToStringConverter"/>
        <conv:ModeColorConverter x:Key="ModeColorConverter"/>
        <conv:PlayPauseTextConverter x:Key="PlayPauseTextConverter"/>

        <Style TargetType="Button" x:Key="ModernBtn">
            <Setter Property="Background" Value="#FF6B6B"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="15,10"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="10">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Opacity" Value="0.8"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.95" ScaleY="0.95" CenterX="0.5" CenterY="0.5"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Background="#2D2D44" CornerRadius="20" Padding="20" Margin="0,0,0,20">
            <Border.Effect>
                <DropShadowEffect BlurRadius="20" ShadowDepth="5" Opacity="0.3"/>
            </Border.Effect>
            <StackPanel>
                <TextBlock Text="{Binding IsBreakMode, Converter={StaticResource BoolToStringConverter}, FallbackValue='FOCUS TIME'}" 
                           Foreground="#A0A0A0" HorizontalAlignment="Center" FontSize="14"/>

                <TextBlock Text="{Binding TimerText}" 
                           Foreground="{Binding IsBreakMode, Converter={StaticResource ModeColorConverter}}" 
                           FontSize="72" FontWeight="Bold" HorizontalAlignment="Center"/>

                <ProgressBar Value="{Binding ProgressValue}" Maximum="{Binding ProgressMax}" 
                             Height="6" BorderThickness="0" Background="#3E3E5E" Foreground="#FF6B6B" 
                             Margin="0,10,0,0">
                    <ProgressBar.Clip>
                        <RectangleGeometry Rect="0,0,320,6" RadiusX="3" RadiusY="3"/>
                    </ProgressBar.Clip>
                </ProgressBar>
            </StackPanel>
        </Border>

        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,20">
            <Button Command="{Binding ToggleTimerCommand}" Content="{Binding IsTimerRunning, Converter={StaticResource PlayPauseTextConverter}}" 
                    Style="{StaticResource ModernBtn}" Width="120" Margin="0,0,10,0"/>

            <Button Command="{Binding ResetCommand}" Content="Reset" 
                    Style="{StaticResource ModernBtn}" Background="#4D4D64" Width="80"/>
        </StackPanel>

        <TextBlock Grid.Row="2" Text="Ostatnie Sesje" Foreground="White" FontWeight="SemiBold" Margin="5,0,0,10"/>

        <ListBox Grid.Row="2" ItemsSource="{Binding Sessions}" Background="Transparent" BorderThickness="0" Margin="0,20,0,0">
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Border Background="#2D2D44" CornerRadius="8" Padding="10" Margin="0,0,0,8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel>
                                <TextBlock Text="Sesja Pracy" Foreground="White" FontWeight="Bold"/>
                                <TextBlock Text="{Binding EndTimeString}" Foreground="#808080" FontSize="12"/>
                            </StackPanel>
                            <TextBlock Grid.Column="1" Text="{Binding DurationString}" Foreground="#FF6B6B" VerticalAlignment="Center" Margin="10,0"/>

                            <Button Grid.Column="2" Command="{Binding DataContext.DeleteSessionCommand, RelativeSource={RelativeSource AncestorType=Window}}" 
                                    CommandParameter="{Binding}" Content="✕" Background="Transparent" Foreground="#555" BorderThickness="0"/>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>

        <Button Grid.Row="3" Command="{Binding ClearAllCommand}" Content="Wyczyść Historię" 
                Background="Transparent" Foreground="#FF6B6B" BorderThickness="0" Margin="0,10,0,0"/>
    </Grid>
</Window>